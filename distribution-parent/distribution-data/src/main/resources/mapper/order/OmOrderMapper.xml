<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chauncy.data.mapper.order.OmOrderMapper">


    <select id="search" resultType="com.chauncy.data.vo.manage.order.list.SearchOrderVo">
        SELECT
        o.id,s.id,s.`name`,u.`name`,u.phone,o.total_number,o.sum_money,o.sum_money needPayMoney,o.real_money,a.ship_name,a.detailed_address,a.mobile,o.activity_type,o.`status`,o.create_time
        from om_order o,sm_store s,um_user u,um_area_shipping a
        where o.store_id=s.id and o.um_user_id=u.id and o.area_shipping_id=a.id
        and o.del_flag=0 and s.del_flag=0 and u.del_flag=0 and a.del_flag=0
        <if test="orderId!=null">
            and o.id=#{orderId}
        </if>
        <if test="userId!=null">
            and u.id=#{userId}
        </if>
        <if test="phone!=null">
            and u.phone like concat('%', #{phone}, '%')
        </if>
        <if test="storeId!=null">
            AND s.id=#{storeId}
        </if>
        <if test="storeName!=null">
            and s.name like concat('%', #{storeName}, '%')
        </if>
        <if test="startCreateTime!=null">
            and o.create_time &gt;=#{startCreateTime}
        </if>
        <if test="endCreateTime!=null">
            and o.create_time &lt;=#{startCreateTime}
        </if>
        <if test="orderStatus!=null">
            and o.`status`=#{orderStatus}
        </if>
        <if test="minMoney!=null">
            and o.`sum_money` &gt;=#{minMoney}
        </if>
        <if test="maxMoney!=null">
            and o.`status` &lt;=#{maxMoney}
        </if>
        <if test="activityTypeEnum!=null">
            and activity_type=#{activityTypeEnum}
        </if>


    </select>
    <select id="loadById" resultType="com.chauncy.data.vo.manage.order.list.OrderDetailVo">
             select o.id orderId,o.goods_type,o.`status`,o.ship_money,o.sum_money,o.sum_money needPayMoney,
            o.real_money,o.create_time,o.pay_time,o.send_time,o.receive_time,p.pay_order_no,p.pay_type_code
            ,o.real_money payAmount,s.id stroreId,s.name storeName,o.um_user_id,u.phone
            FROM om_order o,pay_order p,sm_store s,um_user u,um_area_shipping a
            where o.pay_order_id=p.id and o.store_id=s.id and o.um_user_id=u.id and o.area_shipping_id=a.id
            and o.id=#{id}
    </select>

</mapper>
