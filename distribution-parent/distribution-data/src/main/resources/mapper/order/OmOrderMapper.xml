<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chauncy.data.mapper.order.OmOrderMapper">


    <select id="search" resultType="com.chauncy.data.vo.manage.order.list.SearchOrderVo">
        SELECT
        o.id orderId,s.id storeId,s.`name` storeName,u.`name`,u.phone,o.total_number,o.total_money,o.total_money
        needPayMoney,o.real_money,o.goods_type,p.ship_name,concat(p.area_name,p.ship_address)
        detailed_address,p.phone mobile,o.activity_type,o.`status`,o.create_time
        from om_order o,sm_store s,um_user u,pay_order p
        where o.store_id=s.id and o.um_user_id=u.id
        and o.del_flag=0 and s.del_flag=0 and u.del_flag=0
        <if test="orderId!=null">
            and o.id=#{orderId}
        </if>
        <if test="userId!=null">
            and u.id=#{userId}
        </if>
        <if test="phone!=null">
            and u.phone like concat('%', #{phone}, '%')
        </if>
        <if test="storeId!=null">
            AND s.id=#{storeId}
        </if>
        <if test="storeName!=null">
            and s.name like concat('%', #{storeName}, '%')
        </if>
        <if test="startCreateTime!=null">
            and o.create_time &gt;=#{startCreateTime}
        </if>
        <if test="endCreateTime!=null">
            and o.create_time &lt;=#{startCreateTime}
        </if>
        <if test="orderStatus!=null">
            and o.`status`=#{orderStatus}
        </if>
        <if test="minMoney!=null">
            and o.`total_money` &gt;=#{minMoney}
        </if>
        <if test="maxMoney!=null">
            and o.`total_money` &lt;=#{maxMoney}
        </if>
        <if test="activityTypeEnum!=null">
            and activity_type=#{activityTypeEnum}
        </if>


    </select>
    <select id="loadById" resultType="com.chauncy.data.vo.manage.order.list.OrderDetailVo">
            select o.id orderId,p.area_name,o.goods_type,o.`status`,o.ship_money,o.total_money,o.total_money needPayMoney,
            o.real_money,o.create_time,o.pay_time,o.send_time,o.receive_time,p.pay_order_no,p.pay_type_code
            ,o.real_money payAmount,s.id storeId,s.name storeName,o.um_user_id,u.phone,p.ship_address detailedAddress,
            p.phone mobile,u.name name,p.ship_name
            FROM om_order o,pay_order p,sm_store s,um_user u,um_area_shipping a
            where o.pay_order_id=p.id and o.store_id=s.id and o.um_user_id=u.id and o.area_shipping_id=a.id
            and o.id=#{id}
    </select>
    <select id="searchGoodsTempVos" resultType="com.chauncy.data.vo.manage.order.list.GoodsTempVo">
            select `name`,standard_str,sell_price,number,sell_price*number subtotal
            from om_goods_temp
            where order_id=#{orderId}
    </select>
    <select id="searchSmOrder" resultType="com.chauncy.data.vo.supplier.order.SmSearchOrderVo">
        SELECT
        o.id orderId,o.goods_type,o.`status`,o.total_number,o.total_money,p.ship_name,concat(p.area_name,p.ship_address)
        detailed_address,p.phone,o.create_time
        from om_order o,pay_order p,um_user u
        where o.store_id=#{storeId} and o.pay_order_id=p.id and u.id=o.um_user_id
        and o.del_flag=0 and u.del_flag=0
        <if test="orderId!=null">
            and o.id=#{orderId}
        </if>
        <if test="userId!=null">
            and o.um_user_id=#{userId}
        </if>
        <if test="phone!=null">
            and u.phone like concat('%', #{phone}, '%')
        </if>
        <if test="startCreateTime!=null">
            and o.create_time &gt;=#{startCreateTime}
        </if>
        <if test="endCreateTime!=null">
            and o.create_time &lt;=#{endCreateTime}
        </if>
        <if test="startUpdateTime!=null">
            and o.update_time &gt;=#{startUpdateTime}
        </if>
        <if test="endUpdateTime!=null">
            and o.update_time &lt;=#{endUpdateTime}
        </if>
        <if test="orderStatus!=null">
            and o.`status`=#{orderStatus}
        </if>
    </select>
    <select id="loadSmById" resultType="com.chauncy.data.vo.supplier.order.SmOrderDetailVo">
            select o.goods_type,o.id orderId,o.`status`,o.um_user_id,u.name name,o.create_time,o.pay_time,o.send_time,o.receive_time,
            p.pay_order_no,p.pay_type_code,o.total_money,o.reward_shop_ticket,o.red_envelops_money,o.shop_ticket_money,
            o.ship_money,o.tax_money,o.real_money,p.ship_name,p.phone mobile,p.area_name,p.ship_address detailedAddress

            FROM om_order o,pay_order p,um_user u
            where o.pay_order_id=p.id  and o.um_user_id=u.id
            and o.del_flag=0 and u.del_flag=0
            and o.id=#{id}
    </select>
    <select id="searchSendOrderVos" resultType="com.chauncy.data.vo.supplier.order.SmSendOrderVo">
            SELECT
            o.id orderId,o.goods_type,o.total_number,o.total_money,o.ship_money,o.create_time,u.id userId,u.true_name,p.area_name,p.ship_address ,p.ship_name,
            p.ship_address shipAddress,p.phone mobile,p.area_name areaNam,o.send_time
            from om_order o,pay_order p,um_user u
            where o.store_id=#{storeId} and o.pay_order_id=p.id and u.id=o.um_user_id
            and o.del_flag=0 and u.del_flag=0
            <if test="orderId!=null">
                and o.id=#{orderId}
            </if>
            <if test="userId!=null">
                and o.um_user_id=#{userId}
            </if>
            <if test="phone!=null">
                and u.phone like concat('%', #{phone}, '%')
            </if>
            <if test="shipName!=null">
                and p.ship_name like concat('%', #{shipName}, '%')
            </if>
            <if test="mobile!=null">
                and p.phone like concat('%', #{mobile}, '%')
            </if>
            <if test="startCreateTime!=null">
                and o.create_time &gt;=#{startCreateTime}
            </if>
            <if test="endCreateTime!=null">
                and o.create_time &lt;=#{endCreateTime}
            </if>
            and o.`status`=#{orderStatus}
    </select>
    <select id="searchSendGoodsTemp" resultType="com.chauncy.data.vo.supplier.order.SmSendGoodsTempVo">
            select `name`,standard_str,sell_price,number,icon,article_number
            from om_goods_temp
            where order_id=#{orderId}
    </select>
    <select id="loadLogisticsById" resultType="com.chauncy.data.vo.supplier.order.SmOrderLogisticsVo">
            select o.goods_type,o.id orderId,o.`status`,p.ship_name,p.phone mobile,p.area_name,p.ship_address detailedAddress,
            l.logi_name,l.logistics_no,l.data
            FROM om_order o,pay_order p,om_order_logistics l
            where o.pay_order_id=p.id and o.id=l.order_id
            and o.del_flag=0
            and o.id=#{id}
    </select>
    <select id="searchAppOrder" resultType="com.chauncy.data.vo.app.order.my.AppSearchOrderVo">
            select o.goods_type,o.id orderId,o.`status`,o.real_money,o.total_number,o.store_id,
                    s.name storeName
            FROM om_order o,sm_store s
            where o.store_id=s.id and o.um_user_id=#{userId}
            <if test="orderStatusEnum!=null">
                and o.status=#{orderStatusEnum}
            </if>
            and o.del_flag=0 and s.del_flag=0
    </select>
    <select id="getPayOrderByOrderId" resultType="com.chauncy.data.domain.po.pay.PayOrderPo">
            select p.*
            from om_order o,pay_order p
            where o.id=#{orderId} and p.id=o.pay_order_id
    </select>

</mapper>
