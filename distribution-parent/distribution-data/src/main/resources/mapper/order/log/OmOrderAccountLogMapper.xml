<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chauncy.data.mapper.order.log.OmOrderAccountLogMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.chauncy.data.domain.po.order.log.OmOrderAccountLogPo">
        <id column="id" property="id" />
        <result column="parent_id" property="parentId" />
        <result column="balance" property="balance" />
        <result column="last_balance" property="lastBalance" />
        <result column="um_user_id" property="umUserId" />
        <result column="account_type" property="accountType" />
        <result column="amount" property="amount" />
        <result column="om_order_id" property="omOrderId" />
        <result column="log_type" property="logType" />
        <result column="user_type" property="userType" />
        <result column="payment_way" property="paymentWay" />
        <result column="arrival_way" property="arrivalWay" />
        <result column="log_matter" property="logMatter" />
        <result column="pay_order_id" property="payOrderId" />
        <result column="create_by" property="createBy" />
        <result column="create_time" property="createTime" />
        <result column="update_by" property="updateBy" />
        <result column="update_time" property="updateTime" />
        <result column="del_flag" property="delFlag" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, parent_id, balance, last_balance, um_user_id, account_type, amount, om_order_id, log_type, user_type, payment_way, arrival_way, log_matter, pay_order_id, create_by, create_time, update_by, update_time, del_flag
    </sql>


    <select id="searchPlatformLogPaging" resultType="com.chauncy.data.vo.manage.order.log.SearchPlatformLogVo">
        select ooal.pay_order_id,
                po.pay_id,
                ooal.um_user_id,<!-- pay_order 的下单人id -->
                ooal.log_type,
                ooal.log_matter,
				ooal.um_user_id as phone, <!-- pay_order 的下单人手机号码 -->
				po.total_real_pay_money,
				ooal.payment_way,
				ooal.arrival_way,
				ooal.create_time
        from om_order_account_log ooal
        left join pay_order po
        on ooal.pay_order_id = po.id
        <where>
            <if test="payOrderId != null">
                and ooal.pay_order_id == #{payOrderId}
            </if>
            <if test="payId != null">
                and po.pay_id == #{payId}
            </if>
            <if test="umUserId != null">
                and po.um_user_id == #{umUserId}
            </if>
            <if test="logType != null and logType != ''">
                and po.log_type == #{logType}
            </if>
            <if test="logMatter != null and logMatter != ''">
                and po.log_matter == #{logMatter}
            </if>
            <if test="phone != null and phone != ''">
                and po.log_matter == #{phone}  <!-- pay_order 的下单人手机号码 -->
            </if>
            <if test="startTime != null">
                and date(ooal.create_time) <![CDATA[<= ]]>  #{startTime}
            </if>
            <if test="endTime != null">
                and date(ooal.create_time) <![CDATA[<= ]]> #{endTime}
            </if>
        </where>
    </select>

</mapper>
